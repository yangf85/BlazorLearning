# BlazorLearning 学习进度记录

## 项目概述
- **项目名称**：BlazorLearning
- **学习目标**：掌握Blazor权限框架开发
- **技术栈**：ASP.NET Core Web API + FreeSql + PostgreSQL + Blazor
- **开始时间**：2025年6月26日

## 整体学习路线（加速版）

### 🎯 阶段一：后端API基础（3-4天）
**目标**：搭建完整的Web API后端 + FreeSql + PostgreSQL

### 🔐 阶段二：认证授权基础（3-4天）
**目标**：实现JWT认证和角色权限

### 🖥️ 阶段三：Blazor前端开发（5-6天）
**目标**：创建完整的Blazor权限应用

### 📊 阶段四：权限框架完善（3-4天）
**目标**：高级权限功能和优化

### 🚀 阶段五：项目部署（1-2天）
**目标**：容器化部署

**总计**：15-20天完成整个权限框架学习

---

## 详细进度跟踪

### 阶段一：后端API基础（Day 1-4）
**开始时间**：2025年6月26日  
**预计完成**：2025年6月29日  
**实际完成**：_待填写_

#### Day 1：项目搭建 + 基础API ✅ **已完成**
- [x] 创建BlazorLearning解决方案 - 2025/6/26
- [x] 创建BlazorLearning.Api项目 - 2025/6/26
- [x] 配置Scalar API文档界面 - 2025/6/26
- [x] 创建User模型和基础Controller - 2025/6/26
- [x] 实现GET用户列表接口 - 2025/6/26
- [x] 实现GET单个用户接口 - 2025/6/26
- [x] 测试API接口正常工作 - 2025/6/26

#### Day 2：FreeSql + PostgreSQL集成
- [ ] 安装FreeSql.Provider.PostgreSQL包
- [ ] 配置PostgreSQL连接和FreeSql
- [ ] 创建User实体和表结构
- [ ] 实现Repository模式
- [ ] 完成用户CRUD操作

#### Day 3：数据验证和错误处理
- [ ] 添加模型验证（Data Annotations）
- [ ] 实现全局异常处理中间件
- [ ] 添加日志记录
- [ ] API响应格式统一
- [ ] 完善Swagger文档注释

#### Day 4：准备认证基础
- [ ] 设计用户认证相关表结构
- [ ] 创建角色（Role）实体
- [ ] 实现密码加密工具类
- [ ] 准备JWT配置

### 阶段二：认证授权基础（Day 5-8）
**开始时间**：2025年6月30日  
**预计完成**：2025年7月3日  
**实际完成**：_待填写_

#### Day 5：JWT认证实现
- [ ] 安装JWT相关包
- [ ] 配置JWT认证服务
- [ ] 实现用户注册API
- [ ] 实现登录API（返回JWT Token）
- [ ] 测试Token验证

#### Day 6：角色权限系统
- [ ] 创建角色管理API
- [ ] 实现用户角色分配
- [ ] 添加基于角色的API权限控制
- [ ] 学习Claims和Policy授权
- [ ] 创建权限验证特性

#### Day 7：权限细化
- [ ] 设计权限表结构（菜单权限、操作权限）
- [ ] 实现动态权限分配
- [ ] 创建权限验证中间件
- [ ] 测试不同角色的API访问

#### Day 8：认证优化
- [ ] 实现Token刷新机制
- [ ] 添加登录状态记录
- [ ] 优化密码安全策略
- [ ] 完善认证相关API文档

### 阶段三：Blazor前端开发（Day 9-14）
**开始时间**：2025年7月4日  
**预计完成**：2025年7月9日  
**实际完成**：_待填写_

#### Day 9：Blazor项目创建
- [ ] 创建BlazorLearning.Web项目
- [ ] 配置HttpClient和API基础URL
- [ ] 创建基础布局和导航组件
- [ ] 实现路由配置

#### Day 10：API集成和数据展示
- [ ] 创建API服务类
- [ ] 实现用户列表页面
- [ ] 添加数据加载状态处理
- [ ] 实现用户详情页面

#### Day 11：表单和CRUD操作
- [ ] 创建用户添加/编辑表单
- [ ] 实现客户端验证
- [ ] 添加成功/错误提示组件
- [ ] 完成用户管理完整功能

#### Day 12：认证集成
- [ ] 实现登录/注册页面
- [ ] 集成JWT Token到Blazor
- [ ] 配置AuthenticationStateProvider
- [ ] 实现自动Token刷新

#### Day 13：权限控制
- [ ] 实现路由权限保护
- [ ] 创建权限验证组件
- [ ] 添加动态菜单显示
- [ ] 实现按钮级权限控制

#### Day 14：前端优化
- [ ] 添加Loading组件
- [ ] 优化错误处理和用户体验
- [ ] 实现退出登录功能
- [ ] 前端权限缓存优化

### 阶段四：权限框架完善（Day 15-18）
**开始时间**：2025年7月10日  
**预计完成**：2025年7月13日  
**实际完成**：_待填写_

#### Day 15：权限管理界面
- [ ] 创建角色管理页面
- [ ] 实现权限分配界面
- [ ] 添加用户角色管理功能
- [ ] 创建权限树组件

#### Day 16：高级权限功能
- [ ] 实现权限继承和组合
- [ ] 添加操作日志记录
- [ ] 创建权限变更通知机制
- [ ] 实现权限缓存策略

#### Day 17：系统优化
- [ ] 性能优化（数据库查询、前端渲染）
- [ ] 安全加固（SQL注入防护、XSS防护）
- [ ] 添加API限流功能
- [ ] 完善错误处理和日志

#### Day 18：功能完善
- [ ] 添加用户在线状态管理
- [ ] 实现多设备登录控制
- [ ] 创建系统设置页面
- [ ] 完善帮助文档和使用说明

### 阶段五：项目部署（Day 19-20）
**开始时间**：2025年7月14日  
**预计完成**：2025年7月15日  
**实际完成**：_待填写_

#### Day 19：容器化和部署准备
- [ ] 编写Dockerfile
- [ ] 配置docker-compose（API + PostgreSQL）
- [ ] 准备生产环境配置
- [ ] 数据库迁移脚本

#### Day 20：部署和测试
- [ ] 部署到云服务器或本地Docker
- [ ] 配置反向代理（Nginx）
- [ ] 性能测试和安全测试
- [ ] 编写部署文档

---

## 里程碑检查点（加速版）

### ✅ 里程碑1（Day 4）：后端API完成
- [ ] FreeSql + PostgreSQL正常工作
- [ ] 完整的用户CRUD API
- [ ] 基本的数据验证和错误处理

### ✅ 里程碑2（Day 8）：认证系统完成
- [ ] JWT认证机制正常工作
- [ ] 用户注册登录功能完善
- [ ] 基于角色的API权限控制

### ✅ 里程碑3（Day 14）：Blazor应用完成
- [ ] Blazor前端应用正常运行
- [ ] 前后端认证集成成功
- [ ] 完整的权限控制功能

### ✅ 里程碑4（Day 18）：权限系统完成
- [ ] 完整的权限管理界面
- [ ] 高级权限功能实现
- [ ] 系统性能和安全性优化

### ✅ 里程碑5（Day 20）：项目部署完成
- [ ] 成功容器化部署
- [ ] 生产环境正常运行
- [ ] 完整的项目文档

---

## 技术栈详细信息

### 后端技术
- **框架**：ASP.NET Core 9.0 Web API
- **ORM**：FreeSql
- **数据库**：PostgreSQL
- **认证**：JWT + ASP.NET Core Identity
- **文档**：OpenAPI + Scalar

### 前端技术
- **框架**：Blazor Server 或 Blazor WebAssembly
- **UI组件**：待定（Bootstrap/Ant Design Blazor/MudBlazor）
- **状态管理**：内置状态管理
- **HTTP客户端**：HttpClient

### 开发工具
- **IDE**：Visual Studio 2022
- **数据库工具**：pgAdmin 4
- **版本控制**：Git + GitHub
- **容器化**：Docker

---

## 代码提交规范

### Commit Message格式
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type类型
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档修改
- `style`: 代码格式修改
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

### 示例
```
feat(auth): 添加JWT认证功能

- 实现JWT Token生成和验证
- 添加登录API端点
- 集成ASP.NET Core Identity

Closes #123
```

---

## 学习资源

### 官方文档
- [ASP.NET Core文档](https://docs.microsoft.com/aspnet/core)
- [Blazor文档](https://docs.microsoft.com/aspnet/core/blazor)
- [FreeSql文档](https://freesql.net/)

### 推荐教程
- [ASP.NET Core Web API教程](https://docs.microsoft.com/learn/paths/create-web-api-with-aspnet-core/)
- [Blazor入门教程](https://docs.microsoft.com/learn/paths/build-web-apps-with-blazor/)

### 社区资源
- [Stack Overflow](https://stackoverflow.com/questions/tagged/blazor)
- [ASP.NET Core GitHub](https://github.com/dotnet/aspnetcore)

---

## 问题记录和解决方案

### Day 1 问题汇总（2025年6月26日）

<details>
<summary>1. OpenAPI 配置和调试接口工具选择</summary>

**问题描述**：如何配置 .NET 9 WebAPI 的接口调试工具

**解决方案**：
- **使用 Scalar（推荐）**：
  ```bash
  dotnet add package Scalar.AspNetCore
  ```
  
  ```csharp
  if (app.Environment.IsDevelopment())
  {
      app.MapOpenApi();
      app.MapScalarApiReference(options =>
      {
          options.WithTitle("我的 API 文档")
                 .WithTheme(ScalarTheme.BluePlanet)
                 .WithDefaultHttpClient(ScalarTarget.CSharp, ScalarClient.HttpClient);
      });
  }
  ```

- **使用 Swagger UI（传统方案）**：
  ```bash
  dotnet add package Swashbuckle.AspNetCore
  ```
  
  ```csharp
  if (app.Environment.IsDevelopment())
  {
      app.MapOpenApi();
      app.UseSwaggerUI(options =>
      {
          options.SwaggerEndpoint("/openapi/v1.json", "v1");
          options.RoutePrefix = ""; // 设置根路径访问
      });
  }
  ```

**学习要点**：
- Scalar 比 Swagger UI 更现代、更美观
- 两者都基于 OpenAPI 规范
- .NET 9 推荐使用 OpenAPI 而不是传统的 Swagger 生成方式
</details>

<details>
<summary>2. 浏览器自动启动和路径配置</summary>

**问题描述**：启动项目后需要手动输入地址访问 API 文档

**解决方案**：
在 `Properties/launchSettings.json` 中配置：
```json
{
  "profiles": {
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "scalar/v1",
      "applicationUrl": "https://localhost:7157;http://localhost:5000",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

**关键配置**：
- `"launchBrowser": true` - 自动启动浏览器
- `"launchUrl": "scalar/v1"` - 指定启动时访问的路径

**学习要点**：
- `launchSettings.json` 控制开发环境的启动行为
- 不同的 profile 可以配置不同的启动方式
</details>

<details>
<summary>3. 找不到页面的路径问题</summary>

**问题描述**：访问 `https://localhost:7157/` 提示找不到页面

**解决方案**：
- **Scalar 正确访问路径**：`https://localhost:7157/scalar/v1`
- **Swagger UI 正确访问路径**：`https://localhost:7157/swagger`
- **OpenAPI 规范文档**：`https://localhost:7157/openapi/v1.json`

**可选的根路径重定向**：
```csharp
// 方案1：重定向到 Scalar
app.MapGet("/", () => Results.Redirect("/scalar/v1"));

// 方案2：设置 Swagger UI 在根路径
app.UseSwaggerUI(options =>
{
    options.RoutePrefix = ""; // 空字符串表示根路径
});
```

**学习要点**：
- 不同工具有不同的默认路径
- 根路径默认没有任何内容，需要手动配置
</details>

<details>
<summary>4. Controller 控制器的作用和概念</summary>

**问题描述**：不理解 Controller 是用来干什么的

**解决方案**：
Controller（控制器）是 Web API 的核心组件，相当于"服务窗口"：

**主要作用**：
1. **接收 HTTP 请求**：处理来自客户端的各种 HTTP 请求
2. **处理业务逻辑**：执行具体的业务操作
3. **返回 HTTP 响应**：将处理结果返回给客户端

**实际例子**：
```csharp
[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase
{
    [HttpGet]                     // GET /api/users
    public ActionResult<IEnumerable<User>> GetUsers()
    
    [HttpGet("{id}")]            // GET /api/users/1
    public ActionResult<User> GetUser(int id)
    
    [HttpPost]                   // POST /api/users
    public ActionResult CreateUser(User user)
}
```

**学习要点**：
- Controller = API的入口点
- 一个 Controller 通常管理一类资源（如用户、订单等）
- 方法对应具体的操作（增删改查）
</details>

<details>
<summary>5. Route 路由特性的含义</summary>

**问题描述**：`[Route("api/[controller]")]` 这个特性的特殊含义

**解决方案**：
`[Route("api/[controller]")]` 是路由模板：

**占位符替换规则**：
- `[controller]` 会被自动替换为控制器名称（去掉 Controller 后缀）
- `UsersController` → `users`
- `ProductsController` → `products`

**完整的 URL 构建**：
```csharp
[Route("api/[controller]")]        // 控制器路由
public class UsersController : ControllerBase
{
    [HttpGet]                      // 方法路由
    public ActionResult GetUsers()
    // 最终 URL：GET /api/users
    
    [HttpGet("{id}")]              // 带参数的路由
    public ActionResult GetUser(int id)
    // 最终 URL：GET /api/users/{id}
}
```

**优势**：
- 保持 API 路径的一致性
- 避免重复编写路由
- 重构友好（改类名自动更新路由）

**学习要点**：
- 路由模板让 URL 规则标准化
- 占位符提供了灵活性和自动化
</details>

<details>
<summary>6. 如何在 Scalar 中测试 API 接口</summary>

**问题描述**：不知道如何在 Scalar 界面中测试 API

**解决方案**：
**测试步骤**：
1. 启动项目，打开 `https://localhost:7157/scalar/v1`
2. 在左侧找到要测试的接口
3. 点击接口名称
4. 点击 "Try it out" 按钮
5. 填写必要的参数（如果有）
6. 点击 "Execute" 或 "Send" 按钮
7. 查看响应结果

**具体测试用例**：
- `GET /api/users` - 直接执行，无需参数
- `GET /api/users/{id}` - 在 id 参数框输入 1、2、3 等

**预期结果验证**：
- 状态码 200 表示成功
- 状态码 404 表示未找到（如 id=999）
- Response Body 包含 JSON 数据

**学习要点**：
- Scalar 提供了直观的接口测试界面
- 可以实时测试不同参数的效果
- 观察状态码和响应内容判断接口是否正常
</details>

### 学习心得总结

**Day 1 主要成就**：
- ✅ 成功搭建了 ASP.NET Core 9.0 Web API 项目
- ✅ 配置了现代化的 Scalar API 文档工具
- ✅ 创建了基础的用户管理 API（GET 操作）
- ✅ 理解了 Controller、Route、HTTP 方法等核心概念
- ✅ 掌握了使用 Scalar 测试 API 的方法

**关键知识点**：
1. .NET 9 推荐使用 OpenAPI 而不是传统 Swagger
2. Scalar 是比 Swagger UI 更现代的 API 文档工具
3. Controller 是 Web API 的"服务窗口"
4. Route 特性中的 `[controller]` 是智能占位符
5. `launchSettings.json` 控制开发环境行为

**下一步计划**：
明天开始 Day 2：FreeSql + PostgreSQL 集成，将模拟数据替换为真实数据库操作。

---

## 项目展示

### 功能截图
_项目完成后添加功能截图_

### 在线演示
_部署完成后添加演示链接_

### 代码仓库
- **GitHub**：_添加仓库链接_

---

**最后更新时间**：2025年6月26日  
**当前阶段**：阶段一 - Day 1 项目搭建（已完成）  
**总体进度**：1/20天 (5%) → **完成 Day 1**